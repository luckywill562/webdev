import{b as y,R as e,L as C,r as x,u as L}from"./vendor.7b712f9f.js";import{w as S,F as v,n as N,X as F,L as P,Q as k,t as A,ac as D}from"./GeneralCondition.59d0a2ff.js";import{p as I,M,G as T,L as b,b as R,I as z,d as H,e as U,f as B,A as G,u as V,s as X,c as $}from"./main.da775b16.js";const j=t=>{var s;const f=y(),[_,m]=e.useState(!1),[r,i]=e.useState(!1);e.useEffect(()=>{p()},[]);const p=async()=>{if(t.element.post_reply.length>0)var a=t.element.post_reply[t.element.post_reply.length-1].response_id;else var a=0;m(!0);var l=new FormData;l.append("url","RESTAPI/comments/get");const E={reply:!1,parent_id:t.element.post.post_id,element_id:t.element.post.post_id,type:"post"};l.append("params",JSON.stringify(E)),l.append("page",a),v("/api",l,c=>{(c==null?void 0:c.success)===1&&f(I({post_id:t.element.post.post_id,data:c})),m(!1)})},d=a=>{t.onComment(a)},g=a=>{console.log(a)},n=t.element.post,h=t.element.author;return e.createElement(e.Fragment,null,e.createElement("div",{className:"Fdo",style:{maxwidth:"100%",width:540}},e.createElement("div",{className:"ELG App"},e.createElement(M,{onClick:()=>t.navigate(-1),title:"Commentaires"}),h&&n&&e.createElement("div",{className:"post-card",style:{margin:0}},e.createElement("div",{className:"card-top",style:{paddingTop:0}},e.createElement(N,{author:h,avatarsize:44},e.createElement("div",{className:"card-settings"},e.createElement("i",{className:"arrow_carrot-down"},e.createElement("svg",{width:"24",height:"24",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"#000000"},e.createElement("g",null,e.createElement("path",{d:"M 22.782,13.8L 17,19.582L 11.218,13.8c-0.39-0.39-1.024-0.39-1.414,0c-0.39,0.39-0.39,1.024,0,1.414 l 6.486,6.486c 0.196,0.196, 0.454,0.294, 0.71,0.292c 0.258,0, 0.514-0.096, 0.71-0.292l 6.486-6.486c 0.39-0.39, 0.39-1.024,0-1.414 C 23.806,13.41, 23.172,13.41, 22.782,13.8z"})))))),r&&e.createElement(e.Fragment,null,n.content&&e.createElement("div",{className:"Fdo Ert"},e.createElement("div",{className:"post-text",style:{fontSize:n.content.length<=200&&+n.media_count==0?22:"",fontWeight:n.content.length<=200&&+n.media_count==0?600:"",lineHeight:1.2},dangerouslySetInnerHTML:{__html:n.content}})),e.createElement(F,{e:n})),e.createElement("div",{className:"Ert"},e.createElement(C,{to:"#",onClick:a=>{a.preventDefault(),i(!r)}},r?"Masquer":"Afficher"," la publication"))),r&&t.element.media.length>0&&e.createElement(T,{media:t.element.media,media_count:+n.media_count,post_id:n.post_id,type:t.element.type}),e.createElement(b,{element:n,commentLink:!1,type:"post",to:`/likes/post/${n==null?void 0:n.post_id}`,state:{background:t.location.state.background}}),e.createElement("div",null,e.createElement("hr",{className:"Fdo EvR jb3vyjys"}),e.createElement(x.exports.Suspense,{fallback:e.createElement(P,null)},e.createElement("div",{className:"Fdo tw6a2znq vcx Kmm aovydwv3"},e.createElement("div",{className:"Fdo vcx"},e.createElement("div",{className:"Fdo Aic Hte Eho LCR _2dbep  ",style:{marginBottom:2,height:36,width:36}},e.createElement("img",{"data-src":t.session_user.avatar.medium,className:"hty ELG hrt lazyload"}))),e.createElement(R,{onComment:d})),e.createElement("div",{className:"comment-content"},t.element.post.comment_payment&&e.createElement("div",{className:"Fdo Vpe"},e.createElement("span",{className:"Tpc"},"Pour pouvoir r\xE9pondre, Vous devez payer ",t.element.post.comment_price," ",t.session_user.devise)),e.createElement(z,{next:p,next_page:(s=t.element)==null?void 0:s.has_next_page,loading:_},t.element.post_reply.length>0&&e.createElement(H,{comment:t.element.post_reply,likeComment:g})))))))))};var q=S(j);const J=t=>{const[f,_]=e.useState(!1),[m,r]=e.useState(void 0),i=L(s=>s),p=i.SinglePostsList,d=y(),g=()=>{var s=new FormData;s.append("post_id",t.useParams.element_id),s.append("url","RESTAPI/Status/Single"),v("/api",s,a=>{var l;_(!1),a.posts&&((l=a.posts)==null?void 0:l.length)!=0&&(r(a.posts),d(B(a.posts)))})},n=()=>{const s=p.slice(),a=s.findIndex(l=>l.post.post_id===t.useParams.element_id);if(a>=0){const l=s[a];r(l)}else _(!0),g()};e.useEffect(()=>{n()},[p]),e.useEffect(()=>{t.location.state.reload&&g()},[]);const h=s=>{var l,E;const a=(l=t==null?void 0:t.useParams)==null?void 0:l.element_id;if(A(s).length>0){let c=Math.floor(Math.random()*1e19+1);const w=D(s);d(G({response_content:w,discussion_id:a,response_id:c,author_id:i.Util.c_user.user_id,author_name:i.Util.c_user.first_name,posted_date:"maintenant",author_username:i.Util.c_user.username,author_avatar:i.Util.c_user.avatar.small,process:!0,type:"post"}));let o=new FormData;o.append("element_id",a),o.append("parent_id",a),o.append("comment_content",w),o.append("fakeID",c),o.append("type","post"),o.append("url","RESTAPI/comments/new"),o.append("author_id",(E=m==null?void 0:m.post)==null?void 0:E.author_id),o.append("reply",!1),v("/api",o,u=>{d(V({content:u==null?void 0:u.data,fakeID:c})),d(X(u)),setTimeout(()=>{d($())},2e3)},u=>{console.log(u)})}};return e.createElement(U,{show:!0,onHide:()=>t.navigate(-1),nopadding:"true"},f||!m?e.createElement(k,null):e.createElement(q,{session_user:i.Util.c_user,element:m,post_id:t.useParams.element_id,onComment:h}))};var W=S(J);export{W as default};
