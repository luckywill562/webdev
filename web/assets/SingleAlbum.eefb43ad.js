import{a9 as g,s as f,c as w,I as X,d as q,_ as Y,i as $,aa as Q,e as Z}from"./main.da775b16.js";import{b as I,R as e,L as P,r as A,d as ee,u as te}from"./vendor.7b712f9f.js";import{w as G,c as ae,D as ne,G as B,H as se,F,aC as me,z as ce,aD as ie,K as le,R as oe,ac as re,t as de}from"./GeneralCondition.59d0a2ff.js";import{P as ue,M as _e}from"./Player.8bc9ee43.js";const ge=n=>{const t=n.element,i=I(),_=async()=>{var a=t!=null&&t.liked_by_viewer?"UNLIKE":"LIKE";i(g({album_id:t==null?void 0:t.album_id,action:"LIKE_AND_UNLIKE"}));var d=new FormData;const u={element_id:t==null?void 0:t.album_id,author_id:t==null?void 0:t.author_id,action:a,element_type:n==null?void 0:n.type};d.append("url","RESTAPI/Likes/Like"),d.append("params",JSON.stringify(u)),F("/api",d,l=>{i(f(l)),setTimeout(()=>{i(w())},2e3),l.success===0?i(g({album_id:t==null?void 0:t.album_id,action:"LIKE_AND_UNLIKE",likes:l==null?void 0:l.likes})):i(g({album_id:t==null?void 0:t.album_id,action:"LIKE_AND_UNLIKE",likes:l==null?void 0:l.likes}))},l=>{i(f({message:"une erreur s'est produite",success:0})),setTimeout(()=>{i(w())},2e3),i(g({album_id:t==null?void 0:t.album_id,action:"LIKE_AND_UNLIKE"}))})};return e.createElement("div",{className:"Fdo Anv"},e.createElement("div",{className:"Fdo Aic Pag vcx Cdf "},e.createElement("div",{className:"card-action Fdo ELG Cdf Aic Pac"},e.createElement("span",{className:"PaN klpyt"},e.createElement("button",{onClick:_,className:(t==null?void 0:t.liked_by_viewer)==!0?"post-action unfavourite-button":"post-action favourite-button"},t!=null&&t.liked_by_viewer?e.createElement("span",{className:"hbc"},e.createElement(ae,{size:24})):e.createElement("span",{className:""},e.createElement(ne,{size:24})))),n!=null&&n.commentLink?e.createElement("button",{className:"post-action Comment-button",onClick:()=>{n.navigate(`/post/${t.post_id}`)}},e.createElement(B,{size:24})):e.createElement("button",{className:"post-action Comment-button"},e.createElement(B,{size:24}))),e.createElement("section",{className:"Pag Fdo"},e.createElement("div",{className:""},t==null?void 0:t.views," vues"),n!=null&&n.commentLink?e.createElement(P,{to:`/post/${t==null?void 0:t.post_id}`,state:{background:n.location}},e.createElement("span",{className:"Pag"},t==null?void 0:t.comment_counter,"  Commentaires")):e.createElement("span",{className:"Pag"},t==null?void 0:t.comment_counter," Commentaires"))),e.createElement("div",{className:"Fdo Vpe",style:{paddingLeft:3}},e.createElement(se,{media:t,to:`/likes/album/${t==null?void 0:t.album_id}`,state:n.state})))};var Ee=G(ge);const fe=n=>{const t=I(),[i,_]=e.useState(!1);e.useEffect(()=>{n.content.comments.length===0&&n.content.has_next_page&&d()},[]);const a={reply:!1,parent_id:n.content.album_id,element_id:n.content.album_id,type:"album"},d=()=>{if(_(!0),n.content.comments.length===0)var l=0;else var l=n.content.comments[n.content.comments.length-1].response_id;var s=new FormData;s.append("url","RESTAPI/comments/get"),s.append("page",l),s.append("params",JSON.stringify(a)),F("/api",s,o=>{o.success===1?t(g({album_id:n.content.album_id,action:"PushComments",data:o.comments,has_next_page:o.has_next_page})):t(f(o)),_(!1)})},u=l=>{l.preventDefault(),t(g({album_id:n.content.album_id,action:"RELOAD_COMMENT"})),_(!0);var s=new FormData;s.append("url","RESTAPI/comments/get"),s.append("page",0),s.append("params",JSON.stringify(a)),F("/api",s,o=>{o.success===1?t(g({album_id:n.content.album_id,action:"PushComments",data:o.comments,has_next_page:o.has_next_page})):t(f(o)),_(!1)})};return e.createElement(e.Fragment,null,e.createElement(P,{to:"#",onClick:u},"reload"),!n.content.has_next_page&&!i&&n.content.comments.length===0?e.createElement("div",{className:"Fdo Aic Lns hty"},"Aucun commentaire"):e.createElement(X,{next:d,next_page:n.content.has_next_page,loading:i,margin:"0px"},e.createElement(q,{comment:n.content.comments})))},he=A.exports.lazy(()=>Y(()=>import("./main.da775b16.js").then(function(n){return n.an}),["main.da775b16.js","main.5922880b.css","vendor.7b712f9f.js","GeneralCondition.59d0a2ff.js","GeneralCondition.c3442c85.css"])),ve=n=>{var M,T;const t=I(),[i,_]=e.useState(!1),[a,d]=e.useState({}),[u,l]=e.useState(0),[s,o]=e.useState({}),y=ee(),v=e.useRef(null),[h,S]=e.useState(0),k=e.useRef(null),[b,D]=e.useState(600),[R,be]=e.useState(0),E=te(c=>c),C=E.VisitedAlbumLists;e.useEffect(()=>{const c=C.find(m=>m.album.album_id===n.useParams.id);c?(d(c),c.images.length>0&&o(c.images[0])):W()},[]);const W=()=>{_(!0);let c=new FormData;c.append("album_id",n.useParams.id),c.append("url","RESTAPI/album/Single"),$("/api",c,m=>{m.success===1?(d(m.album),t(Q(m.album)),m.album.images.length>0&&o(m.album.images[0])):(t(f(m)),setTimeout(()=>{t(w())},1e3),n.navigate(-1)),_(!1)})};e.useEffect(()=>{const c=C.find(m=>m.album.album_id===n.useParams.id);c&&d(c)},[C]),e.useEffect(()=>{S(v.current.offsetHeight),window.addEventListener("resize",()=>{v.current&&S(v.current.offsetHeight)})},[]),e.useEffect(()=>{h>0&&s&&D(h*s.media_width/s.media_height)},[h]),e.useEffect(()=>{h>0&&s&&D(h*s.media_width/s.media_height)},[s]);const j=c=>{var p,N,L,z,H,K,V;let m=Math.floor(Math.random()*1e19+1);const U={response_content:re(de(c)),discussion_id:a==null?void 0:a.album_id,response_id:m,author_id:(p=E.Util)==null?void 0:p.min_user_content.user_id,author_name:(N=E.Util)==null?void 0:N.min_user_content.first_name,author_username:(L=E.Util)==null?void 0:L.min_user_content.username,author_avatar:(z=E.Util)==null?void 0:z.min_user_content.avatar,process:!0,posted_date:"maintenant",type:"album_media"};t(g({album_id:a==null?void 0:a.album.album_id,action:"NEW_COMMENT",comment:U}));let r=new FormData;r.append("element_id",(H=a==null?void 0:a.album)==null?void 0:H.album_id),r.append("comment_content",c),r.append("type","album"),r.append("fakeID",m),r.append("author_id",(K=a==null?void 0:a.album)==null?void 0:K.author_id),r.append("url","RESTAPI/comments/new"),r.append("parent_id",(V=a==null?void 0:a.album)==null?void 0:V.album_id),r.append("reply",0),$("/api",r,x=>{var O;x.success===1&&t(g({album_id:(O=a==null?void 0:a.album)==null?void 0:O.album_id,action:"NEW_COMMENT",comment:x.data,fakeID:m})),t(f(x)),setTimeout(()=>{t(w())},1e3)})},J=c=>{if(s.media_type!=="video"){var m=new XMLHttpRequest;m.open("GET",c,!0),m.responseType="arraybuffer",m.onload=function(U){var r=new Uint8Array(this.response),p=new Blob([r],{type:"image/jpg"}),N=window.URL||window.webkitURL,L=N.createObjectURL(p);k.current.src=L},m.send()}};return e.createElement(Z,{show:!0,nopadding:"true",onHide:()=>n.navigate(-1),size:"album"},e.createElement("div",{className:"Fdo messagerie-container",style:{padding:0,maxHeight:600,minHeight:230}},e.createElement("div",{ref:v,className:"messages-text-container  RpG Fdo Aic Lns",style:{width:b||"500",background:"rgb(0,0,0)",height:R||"",maxWidth:b||""}},i||!a.images?e.createElement("div",{className:""},"chargement..."):e.createElement(e.Fragment,null,a.images[u-1]&&e.createElement("button",{className:"ApE fdVbn pIc p1c",onClick:()=>{l(u-1),o(a.images[u-1])}},e.createElement("div",{className:"Fdo LCR tBo hgf"},e.createElement(me,{size:32}))),s&&e.createElement(e.Fragment,null,e.createElement(P,{to:`/media?id=${s.media_id}&type=album&element_id=${a.album.album_id}`,state:{background:y.state?y.state.background:y},className:"pIc StyledSignelIconContainer"},e.createElement("span",{className:"Fdo PLP"},e.createElement("svg",{className:"sFc",width:"18",height:"18",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"#000000"},e.createElement("g",null,e.createElement("path",{d:"M 29.922,2.618c-0.102-0.244-0.296-0.44-0.54-0.54C 29.26,2.026, 29.13,2, 29,2l-8,0 C 20.448,2, 20,2.448, 20,3 C 20,3.552, 20.448,4, 21,4l 5.586,0 L 18.292,12.292c-0.39,0.39-0.39,1.024,0,1.414c 0.39,0.39, 1.024,0.39, 1.414,0L 28,5.414L 28,11 C 28,11.552, 28.448,12, 29,12S 30,11.552, 30,11l0-8 l0,0C 30,2.87, 29.974,2.74, 29.922,2.618zM 3,20C 2.448,20, 2,20.448, 2,21l0,8 c0,0.002,0,0.002,0,0.004c0,0.13, 0.026,0.258, 0.076,0.378 c 0.048,0.118, 0.12,0.224, 0.208,0.314c 0.004,0.004, 0.004,0.008, 0.008,0.012c 0.002,0.002, 0.006,0.002, 0.008,0.006 c 0.090,0.088, 0.198,0.162, 0.316,0.21C 2.74,29.974, 2.87,30, 3,30l 8,0 C 11.552,30, 12,29.552, 12,29C 12,28.448, 11.552,28, 11,28L 5.414,28 l 8.292-8.292c 0.39-0.39, 0.39-1.024,0-1.414c-0.39-0.39-1.024-0.39-1.414,0L 4,26.586L 4,21 C 4,20.448, 3.552,20, 3,20z"})))),e.createElement("span",{className:"Fdo"},"Voir la photo")),s.media_type==="video"?e.createElement(ue,{ref:k,video:`/watch/${s.media}`,poster:s.media_src}):e.createElement("img",{ref:k,className:"eximg",src:s.media_src}),(s==null?void 0:s.locked)&&!s.deblocked_by_viewer&&s.media_type==="image"&&e.createElement(ce,null),(s==null?void 0:s.locked)&&!s.deblocked_by_viewer&&!s.create_by_viewer?e.createElement("div",{className:"Fdo aovydwv3 ApE",style:{bottom:10}},e.createElement(_e,{media:s,author:a.author,element:s.media_id,media_change:J,session:E.Util.c_user})):null),a.images[u+1]&&e.createElement("button",{className:"ApE vbyrt pIc p1c",onClick:()=>{l(u+1),o(a.images[u+1])}},e.createElement("div",{className:"Fdo LCR tBo hgf"},e.createElement(ie,{size:32})))),!i&&a.images&&a.images.length===0&&e.createElement("div",{className:""},"Aucun contenu")),e.createElement("div",{className:"Fdo albumContentRight hty ljhf n8ej3o3l p1c"},e.createElement("div",{className:"messages-list-wrapper"},i||!a.author?e.createElement("div",{className:"Fdo  Pag vcx"},e.createElement("div",{className:"Fdo ELG Anv"},e.createElement(le,{length:1}))):e.createElement(e.Fragment,null,e.createElement("div",{className:"Fdo Ert Vpe Pag vcx"},e.createElement("div",{className:"E6d",dangerouslySetInnerHTML:{__html:(M=a.album)==null?void 0:M.title}})),e.createElement("div",{className:"Fdo Vpe Pag vcx"},e.createElement(oe,{author:a==null?void 0:a.author}))),e.createElement("div",{className:"conversation-list-content gslkf"},!i&&a.album&&e.createElement("div",{className:"vcx Kmm Pag"},e.createElement(A.exports.Suspense,{fallback:e.createElement("div",null,"loading...")},e.createElement(fe,{content:a==null?void 0:a.album})))),e.createElement("div",{className:"Fdo Anv"},e.createElement("section",{className:"ltpMr ndfg gslkf"},e.createElement("div",{className:"vcx Pag"},e.createElement("div",{className:"_7UhW9  PIoXz   Tui    MMzan    _0PwGv              fDxYl     ",dangerouslySetInnerHTML:{__html:(T=a==null?void 0:a.album)==null?void 0:T.date_of_creation}})),!i&&a.album&&e.createElement(Ee,{element:a.album,commentLink:!1,type:"album",state:{background:n.location.state.background}})),e.createElement("div",{className:"Fdo Pag Kmm vcx"},e.createElement("div",{className:"Fdo vcx"},e.createElement("div",{className:"Fdo Aic Hte Eho LCR _2dbep  ",style:{marginBottom:2,height:36,width:36}},e.createElement("img",{"data-src":`${E.Util.c_user.avatar.x56}`,className:"hty ELG hrt lazyload"}))),e.createElement(A.exports.Suspense,{fallback:e.createElement("div",null,"loading...")},e.createElement(he,{onComment:j}))))))))};var ye=G(ve);export{ye as default};
